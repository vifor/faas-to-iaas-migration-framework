graph TD
    A[Inicio: Migración FaaS] --> B(Paso 1: Analizar Backend vía Prompt -> openapi.yaml);
    B --> C(Paso 2: Analizar Capa de Datos vía Prompt/IaC -> data-base-definition.txt);
    C --> D{¿Migración en 2 etapas viable?};

    %% Camino de 2 Etapas (Backend primero)
    D -- "Sí <br> (Pocas BDs, Baja Duplicación)" --> E["Implementar Lógica Backend (NestJS Hexagonal) <br> con Adaptador BD FaaS (e.g., DynamoDB)"];
    E --> G{¿Migrar BD ahora? (Opcional)};
    G -- Sí --> I[Diseñar Esquema BD Relacional];
    I --> J[Implementar Adaptador BD Relacional (e.g., SQL)];
    J --> K[Migrar Datos];
    G -- No --> H[Fin: Monolito IaaS Funcional <br> (usando BD FaaS)];

    %% Camino de Migración Unificada (Backend + BD)
    D -- "No <br> (Muchas BDs, Alta Duplicación)" --> L[Diseñar Esquema BD Relacional];
    L --> M["Implementar Lógica Backend (NestJS Hexagonal) <br> con Adaptador BD Relacional (e.g., SQL)"];
    M --> N[Migrar Datos];

    %% Finalización
    K --> H;
    N --> H;